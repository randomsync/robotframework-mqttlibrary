language: python
services:
- docker
dist:
- 'xenial'
python:
- '2.7'
- '3.7'
before_install:
- docker pull eclipse-mosquitto
- docker run -d -p 11883:1883 -p 9001:9001 -v $(pwd)/mosquitto:/mosquitto/config eclipse-mosquitto
- docker run -d -p 1883:1883 eclipse-mosquitto

install:
- pip install -r requirements.txt
script:
- robot -P src tests
deploy:
  - provider: pypi
    user: "__token__"
    password:
      secure: FNm4pha9uqgxkYHqcD9tKpaIbiw1Ue0QNJpxFBvz+ItHNHJ3KJfKHzpU45bRFpDXDjY0x9cLVDWCfAWqxCoBy6+fiBGpqfUwPR/2fgcQnelA3YdhtkQXrM47O42RuPIUPHk1ymG+v54YwWM6NbCNU8GI4NPFMAQeBOdwF8V2P6jMiUq57y5Clq7XzmHQgww23IQje9JSjsIjV45CXkeQemBV2rcZqYofaQNQwJSFtKoT1aZvT44ZRDfShoOt9JC9C7x+9ktPjO9V4T333A+FsjNTfv1QBWGsaqKybQp80rM3I3NmWTBRAswccodVEXvJAKjMxONr28CKSOPw1d2o72c7GZ0gsh8KH70SybSk9Fc2Gn1xkQPb22mhhS2KgF9RmM/jOZ8lTv0MRpHLB2Eqo9SE2B7crb4jOEY9ki4lElxPyGsOnglWUZLq1rFzQqu/nAoAooBdJvgaoPB5nEs2IElyYYP9xqjgxg1HbvqUUl8s4MsGHjiMxjY2XW8aIYz8m0tP1lt0eTBPdxRrXR7C0Bet4HfzTRI9O7A2qK2wqNNo6MW/OYjb3pAqRiWJpFFX9sTQTIiKx0FFjgqEFF2QQ9B9zVyYLlVm+8+Iojz+cLaZ/viNS7MBIZlfO7quV4HXqwHQX76hqtXjQ7r6oYBnXyZ+wA0hfcTDuMkd74Aawm0=
    distributions: "sdist bdist_wheel"
    skip_cleanup: true
    on:
      repo: randomsync/robotframework-mqttlibrary
      tags: true
  - provider: releases
    api_key:
      secure: JAaqldr74M3AwKBUAyCoeEdeFotPgXlSO7ML6IWpv327UXsz/CZyZg3lDnFZEPyUfzr/pndUEN/M/eeHTuLMXVhv5rdaiMWS5pXXcs6mmR7irT5LK3giRJKJpfNWcOTCRkotHJRkMC7vOuHWhuLrJ0a7v4yxZyTcqBsQUq+Qk/Q=
    file: dist/*
    skip_cleanup: true
    draft: true
    on:
      repo: randomsync/robotframework-mqttlibrary
      tags: true
      python: '3.7'
